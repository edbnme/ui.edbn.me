{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "pull-down",
  "type": "registry:ui",
  "title": "Pull Down Menu",
  "description": "A pull down menu with morphing animations. The trigger morphs into the menu container with spring physics.",
  "dependencies": [
    "motion",
    "@phosphor-icons/react",
    "tw-animate-css"
  ],
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "path": "components/ui/pull-down.tsx",
      "content": "/**\r\n * Pull Down Menu Component\r\n *\r\n * A pull down menu with morphing animations. The trigger morphs\r\n * into the menu container, creating a fluid, native-feeling interaction.\r\n *\r\n * Features spring physics and blur transitions for smooth, organic motion.\r\n *\r\n * ---\r\n * Inspired by and adapted from **bloom-menu** by Josh Puckett.\r\n * Original project: https://github.com/joshpuckett/bloom\r\n * Licensed under MIT License.\r\n * ---\r\n *\r\n * @packageDocumentation\r\n */\r\n\r\n\"use client\";\r\n\r\n// =============================================================================\r\n// IMPORTS\r\n// =============================================================================\r\n\r\n// 1. React imports\r\nimport * as React from \"react\";\r\nimport {\r\n  createContext,\r\n  useContext,\r\n  forwardRef,\r\n  useMemo,\r\n  useCallback,\r\n  useRef,\r\n  useState,\r\n  useEffect,\r\n  useLayoutEffect,\r\n  type ReactNode,\r\n  type CSSProperties,\r\n  type MouseEvent,\r\n  type KeyboardEvent,\r\n  type RefObject,\r\n  type MutableRefObject,\r\n} from \"react\";\r\n\r\n// 2. External library imports\r\nimport { createPortal } from \"react-dom\";\r\nimport {\r\n  motion,\r\n  AnimatePresence,\r\n  type Transition,\r\n  type Variants,\r\n} from \"motion/react\";\r\nimport { CaretRightIcon } from \"@phosphor-icons/react\";\r\n\r\n// 3. Internal imports\r\nimport { cn } from \"@/lib/utils\";\r\nimport { useShouldDisableAnimation } from \"@/components/motion-provider\";\r\n\r\n// =============================================================================\r\n// TYPES\r\n// =============================================================================\r\n\r\n/** Direction the menu expands from trigger */\r\nexport type PullDownDirection = \"top\" | \"bottom\" | \"left\" | \"right\";\r\n\r\n/** Anchor point alignment */\r\nexport type PullDownAnchor = \"start\" | \"center\" | \"end\";\r\n\r\n/** Spring configuration for animations */\r\nexport interface PullDownSpringConfig {\r\n  stiffness: number;\r\n  damping: number;\r\n  mass?: number;\r\n}\r\n\r\n/** Detailed animation configuration */\r\nexport interface PullDownAnimationConfig {\r\n  /** Spring stiffness for shape morph */\r\n  morphStiffness?: number;\r\n  /** Spring damping for shape morph */\r\n  morphDamping?: number;\r\n  /** Spring stiffness for content fade */\r\n  contentStiffness?: number;\r\n  /** Spring damping for content fade */\r\n  contentDamping?: number;\r\n  /** Delay before content appears (seconds) */\r\n  contentDelay?: number;\r\n  /** Scale when content is hidden */\r\n  contentScale?: number;\r\n  /** Blur amount for trigger icon (px) */\r\n  triggerBlur?: number;\r\n  /** Blur amount for content (px) */\r\n  contentBlur?: number;\r\n}\r\n\r\n/** Root component props */\r\nexport interface PullDownProps {\r\n  children: ReactNode;\r\n  /** Controlled open state */\r\n  open?: boolean;\r\n  /** Callback when open state changes */\r\n  onOpenChange?: (open: boolean) => void;\r\n  /** Default open state for uncontrolled usage */\r\n  defaultOpen?: boolean;\r\n  /** Detailed animation configuration */\r\n  animationConfig?: PullDownAnimationConfig;\r\n  /** Close when clicking outside the menu */\r\n  closeOnClickOutside?: boolean;\r\n  /** Close when pressing Escape key */\r\n  closeOnEscape?: boolean;\r\n  /** Enable modal behavior with focus trapping */\r\n  modal?: boolean;\r\n  /** Direction the menu expands from trigger */\r\n  direction?: PullDownDirection;\r\n  /** Anchor point alignment */\r\n  anchor?: PullDownAnchor;\r\n  /** Spring animation duration in seconds (default: 0.25) */\r\n  visualDuration?: number;\r\n  /** Spring animation bounce (default: 0.2) */\r\n  bounce?: number;\r\n}\r\n\r\n/** Container component props */\r\nexport interface PullDownContainerProps {\r\n  children: ReactNode;\r\n  /** Size of the closed button state - number for square, or { width, height } for rectangular */\r\n  buttonSize?: number | { width: number; height: number };\r\n  /** Fixed width when open */\r\n  menuWidth?: number;\r\n  /** Border radius of the open menu state */\r\n  menuRadius?: number;\r\n  /** Border radius of the closed button state (defaults to pill shape) */\r\n  buttonRadius?: number;\r\n  /** Additional class names */\r\n  className?: string;\r\n  /** Additional styles */\r\n  style?: CSSProperties;\r\n}\r\n\r\n/** Trigger component props */\r\nexport interface PullDownTriggerProps {\r\n  children: ReactNode;\r\n  /** Disable the trigger */\r\n  disabled?: boolean;\r\n  /** Additional class names */\r\n  className?: string;\r\n  /** Additional styles */\r\n  style?: CSSProperties;\r\n}\r\n\r\n/** Content component props */\r\nexport interface PullDownContentProps {\r\n  children: ReactNode;\r\n  /** Additional class names */\r\n  className?: string;\r\n  /** Additional styles */\r\n  style?: CSSProperties;\r\n  /** Callback when content animation completes */\r\n  onAnimationComplete?: () => void;\r\n}\r\n\r\n/** Item component props */\r\nexport interface PullDownItemProps {\r\n  children: ReactNode;\r\n  /** Called when item is selected */\r\n  onSelect?: () => void;\r\n  /** Disable the item */\r\n  disabled?: boolean;\r\n  /** Close menu after selection */\r\n  closeOnSelect?: boolean;\r\n  /** Additional class names */\r\n  className?: string;\r\n  /** Additional styles */\r\n  style?: CSSProperties;\r\n}\r\n\r\n/** Portal component props */\r\nexport interface PullDownPortalProps {\r\n  children: ReactNode;\r\n  /** Container element for the portal */\r\n  container?: HTMLElement | null;\r\n}\r\n\r\n/** Overlay component props */\r\nexport interface PullDownOverlayProps {\r\n  /** Additional class names */\r\n  className?: string;\r\n  /** Additional styles */\r\n  style?: CSSProperties;\r\n  /** Click handler (defaults to closing menu) */\r\n  onClick?: () => void;\r\n}\r\n\r\n/** SubMenu component props */\r\nexport interface PullDownSubMenuProps {\r\n  children: ReactNode;\r\n  /** Unique identifier for this submenu */\r\n  id: string;\r\n}\r\n\r\n/** SubMenuTrigger component props */\r\nexport interface PullDownSubMenuTriggerProps {\r\n  /** Static children or render prop receiving isActive state */\r\n  children: ReactNode | ((isActive: boolean) => ReactNode);\r\n  /** Additional class names */\r\n  className?: string;\r\n  /** Additional styles */\r\n  style?: CSSProperties;\r\n  /** Disable the trigger */\r\n  disabled?: boolean;\r\n}\r\n\r\n/** SubMenuContent component props */\r\nexport interface PullDownSubMenuContentProps {\r\n  children: ReactNode;\r\n  /** Additional class names */\r\n  className?: string;\r\n  /** Additional styles */\r\n  style?: CSSProperties;\r\n}\r\n\r\n/** Internal context state */\r\ninterface PullDownContextValue {\r\n  open: boolean;\r\n  setOpen: (open: boolean) => void;\r\n  triggerRef: MutableRefObject<HTMLElement | null>;\r\n  contentRef: MutableRefObject<HTMLDivElement | null>;\r\n  animationConfig: Required<PullDownAnimationConfig>;\r\n  closeOnClickOutside: boolean;\r\n  closeOnEscape: boolean;\r\n  modal: boolean;\r\n  isOpenAnimationCompleteRef: MutableRefObject<boolean>;\r\n  direction: PullDownDirection;\r\n  anchor: PullDownAnchor;\r\n  activeSubmenu: string | null;\r\n  setActiveSubmenu: (id: string | null) => void;\r\n  isSubmenuClosing: boolean;\r\n  visualDuration: number;\r\n  bounce: number;\r\n  disableAnimation: boolean;\r\n}\r\n\r\n/** SubMenu context value */\r\ninterface PullDownSubMenuContextValue {\r\n  id: string;\r\n  triggerRef: MutableRefObject<HTMLDivElement | null>;\r\n}\r\n\r\n// =============================================================================\r\n// CONTEXT\r\n// =============================================================================\r\n\r\nconst PullDownContext = createContext<PullDownContextValue | null>(null);\r\n\r\nfunction usePullDownContext(componentName = \"PullDown\"): PullDownContextValue {\r\n  const context = useContext(PullDownContext);\r\n  if (!context) {\r\n    throw new Error(\r\n      `${componentName} must be used within <PullDown>. ` +\r\n        \"Wrap your component tree with <PullDown>\"\r\n    );\r\n  }\r\n  return context;\r\n}\r\n\r\nconst SubMenuContext = createContext<PullDownSubMenuContextValue | null>(null);\r\n\r\nfunction useSubMenuContext(): PullDownSubMenuContextValue {\r\n  const context = useContext(SubMenuContext);\r\n  if (!context) {\r\n    throw new Error(\r\n      \"SubMenu components must be used within a <PullDown.SubMenu> component\"\r\n    );\r\n  }\r\n  return context;\r\n}\r\n\r\n// =============================================================================\r\n// HOOKS\r\n// =============================================================================\r\n\r\n/**\r\n * Hook for controlled/uncontrolled state pattern\r\n */\r\nfunction useControllable<T>({\r\n  value: controlledValue,\r\n  defaultValue,\r\n  onChange,\r\n}: {\r\n  value?: T;\r\n  defaultValue: T;\r\n  onChange?: (value: T) => void;\r\n}): [T, (value: T) => void] {\r\n  const [uncontrolledValue, setUncontrolledValue] = useState(defaultValue);\r\n  const isControlled = controlledValue !== undefined;\r\n  const value = isControlled ? controlledValue : uncontrolledValue;\r\n\r\n  const wasControlled = useRef(isControlled);\r\n\r\n  useEffect(() => {\r\n    if (\r\n      process.env.NODE_ENV !== \"production\" &&\r\n      wasControlled.current !== isControlled\r\n    ) {\r\n      console.warn(\r\n        \"PullDown: A component is changing from\",\r\n        wasControlled.current ? \"controlled\" : \"uncontrolled\",\r\n        \"to\",\r\n        isControlled ? \"controlled\" : \"uncontrolled\",\r\n        \". This is likely a bug.\"\r\n      );\r\n    }\r\n    wasControlled.current = isControlled;\r\n  }, [isControlled]);\r\n\r\n  const setValue = useCallback(\r\n    (newValue: T) => {\r\n      if (!isControlled) {\r\n        setUncontrolledValue(newValue);\r\n      }\r\n      onChange?.(newValue);\r\n    },\r\n    [isControlled, onChange]\r\n  );\r\n\r\n  return [value, setValue];\r\n}\r\n\r\n/**\r\n * Hook to detect clicks outside elements\r\n */\r\nfunction useClickOutside(\r\n  refs: RefObject<HTMLElement | null>[],\r\n  handler: () => void,\r\n  enabled: boolean = true\r\n) {\r\n  useEffect(() => {\r\n    if (!enabled) return;\r\n\r\n    function handleClick(event: globalThis.MouseEvent | TouchEvent) {\r\n      const target = event.target as Node;\r\n      const isOutside = refs.every((ref) => {\r\n        return !ref.current || !ref.current.contains(target);\r\n      });\r\n\r\n      if (isOutside) {\r\n        handler();\r\n      }\r\n    }\r\n\r\n    document.addEventListener(\"mousedown\", handleClick);\r\n    document.addEventListener(\"touchstart\", handleClick);\r\n\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClick);\r\n      document.removeEventListener(\"touchstart\", handleClick);\r\n    };\r\n  }, [refs, handler, enabled]);\r\n}\r\n\r\n/**\r\n * Hook to handle escape key press\r\n */\r\nfunction useEscapeKey(handler: () => void, enabled: boolean = true) {\r\n  useEffect(() => {\r\n    if (!enabled) return;\r\n\r\n    function handleKeyDown(event: globalThis.KeyboardEvent) {\r\n      if (event.key === \"Escape\") {\r\n        event.preventDefault();\r\n        handler();\r\n      }\r\n    }\r\n\r\n    document.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => {\r\n      document.removeEventListener(\"keydown\", handleKeyDown);\r\n    };\r\n  }, [handler, enabled]);\r\n}\r\n\r\n/**\r\n * Hook for reduced motion preference\r\n */\r\nfunction useReducedMotion(): boolean {\r\n  const QUERY = \"(prefers-reduced-motion: reduce)\";\r\n\r\n  const getSnapshot = useCallback(() => {\r\n    if (typeof window === \"undefined\") return false;\r\n    return window.matchMedia(QUERY).matches;\r\n  }, []);\r\n\r\n  const subscribe = useCallback((callback: () => void) => {\r\n    if (typeof window === \"undefined\") return () => {};\r\n    const mediaQuery = window.matchMedia(QUERY);\r\n    mediaQuery.addEventListener(\"change\", callback);\r\n    return () => mediaQuery.removeEventListener(\"change\", callback);\r\n  }, []);\r\n\r\n  const getServerSnapshot = useCallback(() => false, []);\r\n\r\n  return React.useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);\r\n}\r\n\r\n// =============================================================================\r\n// ANIMATION CONSTANTS\r\n// =============================================================================\r\n\r\nconst DEFAULT_ANIMATION_CONFIG: Required<PullDownAnimationConfig> = {\r\n  morphStiffness: 382,\r\n  morphDamping: 29,\r\n  contentStiffness: 403,\r\n  contentDamping: 36,\r\n  contentDelay: 0.03,\r\n  contentScale: 0.95,\r\n  triggerBlur: 8,\r\n  contentBlur: 10,\r\n};\r\n\r\nconst REDUCED_MOTION_SPRING: PullDownSpringConfig = {\r\n  stiffness: 1000,\r\n  damping: 100,\r\n};\r\n\r\nconst CONTENT_BLUR = 8;\r\n\r\n// =============================================================================\r\n// UTILITY FUNCTIONS\r\n// =============================================================================\r\n\r\n/** Calculate base position styles based on direction */\r\nfunction getPositionStyles(direction: PullDownDirection): CSSProperties {\r\n  const styles: CSSProperties = {\r\n    position: \"absolute\",\r\n  };\r\n\r\n  switch (direction) {\r\n    case \"top\":\r\n      styles.bottom = 0;\r\n      styles.left = 0;\r\n      break;\r\n    case \"bottom\":\r\n      styles.top = 0;\r\n      styles.left = 0;\r\n      break;\r\n    case \"left\":\r\n      styles.right = 0;\r\n      styles.bottom = 0;\r\n      break;\r\n    case \"right\":\r\n      styles.left = 0;\r\n      styles.bottom = 0;\r\n      break;\r\n  }\r\n\r\n  return styles;\r\n}\r\n\r\n/** Calculate anchor offset for menu alignment */\r\nfunction getAnchorOffset(\r\n  direction: PullDownDirection,\r\n  anchor: PullDownAnchor,\r\n  menuWidth: number,\r\n  menuHeight: number,\r\n  buttonWidth: number,\r\n  buttonHeight: number\r\n) {\r\n  if (anchor === \"start\") {\r\n    return { x: 0, y: 0 };\r\n  }\r\n\r\n  const offsetAmount = anchor === \"center\" ? 0.5 : 1;\r\n\r\n  if (direction === \"top\" || direction === \"bottom\") {\r\n    const xOffset = -(menuWidth - buttonWidth) * offsetAmount;\r\n    return { x: xOffset, y: 0 };\r\n  } else {\r\n    const yOffset = (menuHeight - buttonHeight) * offsetAmount;\r\n    return { x: 0, y: yOffset };\r\n  }\r\n}\r\n\r\n/** Calculate transform origin based on direction and anchor */\r\nfunction getTransformOrigin(\r\n  direction: PullDownDirection,\r\n  anchor: PullDownAnchor\r\n): string {\r\n  const vertical =\r\n    direction === \"top\" ? \"bottom\" : direction === \"bottom\" ? \"top\" : \"center\";\r\n  const horizontal =\r\n    direction === \"left\" ? \"right\" : direction === \"right\" ? \"left\" : \"center\";\r\n\r\n  if (direction === \"top\" || direction === \"bottom\") {\r\n    const h =\r\n      anchor === \"start\" ? \"left\" : anchor === \"end\" ? \"right\" : \"center\";\r\n    return `${h} ${vertical}`;\r\n  } else {\r\n    const v =\r\n      anchor === \"start\" ? \"bottom\" : anchor === \"end\" ? \"top\" : \"center\";\r\n    return `${horizontal} ${v}`;\r\n  }\r\n}\r\n\r\n/** Calculate animation offset based on direction */\r\nfunction getAnimationOffset(direction: PullDownDirection, amount: number) {\r\n  switch (direction) {\r\n    case \"top\":\r\n      return { y: -amount };\r\n    case \"bottom\":\r\n      return { y: amount };\r\n    case \"left\":\r\n      return { x: -amount };\r\n    case \"right\":\r\n      return { x: amount };\r\n  }\r\n}\r\n\r\n// =============================================================================\r\n// ROOT COMPONENT\r\n// =============================================================================\r\n\r\nconst Root = forwardRef<HTMLDivElement, PullDownProps>(function PullDownRoot(\r\n  {\r\n    children,\r\n    open: controlledOpen,\r\n    onOpenChange,\r\n    defaultOpen = false,\r\n    animationConfig,\r\n    closeOnClickOutside = true,\r\n    closeOnEscape = true,\r\n    modal = false,\r\n    direction = \"top\",\r\n    anchor: anchorProp = \"start\",\r\n    visualDuration = 0.25,\r\n    bounce = 0.2,\r\n  },\r\n  ref\r\n) {\r\n  const disableAnimation = useShouldDisableAnimation();\r\n\r\n  // For horizontal directions, anchor is always center\r\n  const anchor =\r\n    direction === \"left\" || direction === \"right\" ? \"center\" : anchorProp;\r\n\r\n  const [open, setOpen] = useControllable({\r\n    value: controlledOpen,\r\n    defaultValue: defaultOpen,\r\n    onChange: onOpenChange,\r\n  });\r\n\r\n  const triggerRef = useRef<HTMLElement | null>(null);\r\n  const contentRef = useRef<HTMLDivElement | null>(null);\r\n  const isOpenAnimationCompleteRef = useRef(false);\r\n  const [activeSubmenu, setActiveSubmenu] = useState<string | null>(null);\r\n\r\n  // Track when submenu is in the process of closing (exit animation)\r\n  const [isSubmenuClosing, setIsSubmenuClosing] = useState(false);\r\n  const submenuClosingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Handle submenu state changes and track closing animation\r\n  const handleSetActiveSubmenu = useCallback(\r\n    (id: string | null) => {\r\n      // Clear any pending timeout\r\n      if (submenuClosingTimeoutRef.current) {\r\n        clearTimeout(submenuClosingTimeoutRef.current);\r\n        submenuClosingTimeoutRef.current = null;\r\n      }\r\n\r\n      if (id === null && activeSubmenu !== null) {\r\n        // Submenu is closing - mark it and wait for animation\r\n        setIsSubmenuClosing(true);\r\n        setActiveSubmenu(null);\r\n        submenuClosingTimeoutRef.current = setTimeout(() => {\r\n          setIsSubmenuClosing(false);\r\n          submenuClosingTimeoutRef.current = null;\r\n        }, visualDuration * 1000 + 50); // Add small buffer\r\n      } else {\r\n        setIsSubmenuClosing(false);\r\n        setActiveSubmenu(id);\r\n      }\r\n    },\r\n    [activeSubmenu, visualDuration]\r\n  );\r\n\r\n  const handleSetOpen = useCallback(\r\n    (newOpen: boolean) => {\r\n      if (newOpen) {\r\n        isOpenAnimationCompleteRef.current = false;\r\n      } else {\r\n        // Clear any pending timeout\r\n        if (submenuClosingTimeoutRef.current) {\r\n          clearTimeout(submenuClosingTimeoutRef.current);\r\n          submenuClosingTimeoutRef.current = null;\r\n        }\r\n        setIsSubmenuClosing(false);\r\n        setActiveSubmenu(null);\r\n      }\r\n      setOpen(newOpen);\r\n    },\r\n    [setOpen]\r\n  );\r\n\r\n  // Handle click outside - if submenu is open or closing, handle appropriately\r\n  const handleClickOutside = useCallback(() => {\r\n    if (activeSubmenu !== null) {\r\n      // If a submenu is open, close submenu first\r\n      handleSetActiveSubmenu(null);\r\n    } else if (isSubmenuClosing) {\r\n      // Submenu is still in closing animation, ignore click\r\n      return;\r\n    } else {\r\n      // No submenu open or closing, close the entire menu\r\n      handleSetOpen(false);\r\n    }\r\n  }, [activeSubmenu, isSubmenuClosing, handleSetActiveSubmenu, handleSetOpen]);\r\n\r\n  // Close on click outside\r\n  useClickOutside(\r\n    [triggerRef, contentRef],\r\n    handleClickOutside,\r\n    open && closeOnClickOutside\r\n  );\r\n\r\n  // Handle escape key - if submenu is open or closing, handle appropriately\r\n  const handleEscapeKey = useCallback(() => {\r\n    if (activeSubmenu !== null) {\r\n      // If a submenu is open, close submenu first\r\n      handleSetActiveSubmenu(null);\r\n    } else if (isSubmenuClosing) {\r\n      // Submenu is still in closing animation, ignore escape\r\n      return;\r\n    } else {\r\n      // No submenu open or closing, close the entire menu\r\n      handleSetOpen(false);\r\n    }\r\n  }, [activeSubmenu, isSubmenuClosing, handleSetActiveSubmenu, handleSetOpen]);\r\n\r\n  // Close on escape\r\n  useEscapeKey(handleEscapeKey, open && closeOnEscape);\r\n\r\n  const mergedAnimationConfig = useMemo(\r\n    () => ({\r\n      ...DEFAULT_ANIMATION_CONFIG,\r\n      ...animationConfig,\r\n    }),\r\n    [animationConfig]\r\n  );\r\n\r\n  const contextValue = useMemo(\r\n    () => ({\r\n      open,\r\n      setOpen: handleSetOpen,\r\n      triggerRef,\r\n      contentRef,\r\n      animationConfig: mergedAnimationConfig,\r\n      closeOnClickOutside,\r\n      closeOnEscape,\r\n      modal,\r\n      isOpenAnimationCompleteRef,\r\n      direction,\r\n      anchor,\r\n      activeSubmenu,\r\n      setActiveSubmenu: handleSetActiveSubmenu,\r\n      isSubmenuClosing,\r\n      visualDuration,\r\n      bounce,\r\n      disableAnimation,\r\n    }),\r\n    [\r\n      open,\r\n      handleSetOpen,\r\n      mergedAnimationConfig,\r\n      closeOnClickOutside,\r\n      closeOnEscape,\r\n      modal,\r\n      direction,\r\n      anchor,\r\n      activeSubmenu,\r\n      handleSetActiveSubmenu,\r\n      isSubmenuClosing,\r\n      visualDuration,\r\n      bounce,\r\n      disableAnimation,\r\n    ]\r\n  );\r\n\r\n  return (\r\n    <PullDownContext.Provider value={contextValue}>\r\n      <div ref={ref} className=\"relative inline-block\">\r\n        {children}\r\n      </div>\r\n    </PullDownContext.Provider>\r\n  );\r\n});\r\n\r\nRoot.displayName = \"PullDown\";\r\n\r\n// =============================================================================\r\n// CONTAINER COMPONENT\r\n// =============================================================================\r\n\r\nconst Container = forwardRef<HTMLDivElement, PullDownContainerProps>(\r\n  function PullDownContainer(\r\n    {\r\n      children,\r\n      buttonSize = 40,\r\n      menuWidth = 200,\r\n      menuRadius = 24,\r\n      buttonRadius,\r\n      className,\r\n      style,\r\n    },\r\n    ref\r\n  ) {\r\n    const {\r\n      open,\r\n      setOpen,\r\n      direction,\r\n      anchor,\r\n      activeSubmenu,\r\n      isSubmenuClosing,\r\n      visualDuration,\r\n      bounce,\r\n      disableAnimation,\r\n    } = usePullDownContext(\"PullDownContainer\");\r\n\r\n    const prefersReducedMotion = useReducedMotion();\r\n    const internalRef = useRef<HTMLDivElement>(null);\r\n    const measureRef = useRef<HTMLDivElement>(null);\r\n\r\n    const buttonWidth =\r\n      typeof buttonSize === \"number\" ? buttonSize : buttonSize.width;\r\n    const buttonHeight =\r\n      typeof buttonSize === \"number\" ? buttonSize : buttonSize.height;\r\n    const [measuredHeight, setMeasuredHeight] = useState<number>(buttonHeight);\r\n\r\n    // Use centralized submenu closing state from context\r\n    // Submenu styles should remain active during close animation\r\n    const submenuStylesActive = activeSubmenu !== null || isSubmenuClosing;\r\n\r\n    const shouldAnimate = !disableAnimation && !prefersReducedMotion;\r\n    const springConfig: Transition = shouldAnimate\r\n      ? { type: \"spring\" as const, visualDuration, bounce }\r\n      : { type: \"spring\" as const, ...REDUCED_MOTION_SPRING };\r\n\r\n    useLayoutEffect(() => {\r\n      if (open && measureRef.current) {\r\n        const height = measureRef.current.offsetHeight;\r\n        setMeasuredHeight(height);\r\n      }\r\n    }, [open]);\r\n\r\n    const handleClick = useCallback(\r\n      (event: MouseEvent) => {\r\n        if (!open) {\r\n          event.preventDefault();\r\n          setOpen(true);\r\n        }\r\n      },\r\n      [open, setOpen]\r\n    );\r\n\r\n    const closedRadius =\r\n      buttonRadius ?? Math.min(buttonWidth, buttonHeight) / 2;\r\n    const positionStyles = getPositionStyles(direction);\r\n    const transformOrigin = getTransformOrigin(direction, anchor);\r\n    const liftAmount = buttonHeight * 0.75;\r\n    const directionOffset = getAnimationOffset(direction, liftAmount);\r\n    const anchorOffset = getAnchorOffset(\r\n      direction,\r\n      anchor,\r\n      menuWidth,\r\n      measuredHeight,\r\n      buttonWidth,\r\n      buttonHeight\r\n    );\r\n\r\n    const openOffset = {\r\n      x: (directionOffset.x || 0) + anchorOffset.x,\r\n      y: (directionOffset.y || 0) + anchorOffset.y,\r\n    };\r\n\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        style={{\r\n          position: \"relative\",\r\n          width: buttonWidth,\r\n          height: buttonHeight,\r\n        }}\r\n      >\r\n        <motion.div\r\n          ref={internalRef}\r\n          onClick={handleClick}\r\n          initial={false}\r\n          animate={{\r\n            width: open ? menuWidth : buttonWidth,\r\n            height: open ? measuredHeight : buttonHeight,\r\n            borderRadius: open ? menuRadius : closedRadius,\r\n            x: open ? openOffset.x : 0,\r\n            y: open ? openOffset.y : 0,\r\n            scale: submenuStylesActive ? 0.96 : 1,\r\n            boxShadow: open\r\n              ? \"0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1)\"\r\n              : \"0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)\",\r\n          }}\r\n          transition={springConfig}\r\n          className={cn(\r\n            \"bg-popover text-popover-foreground ring-1 ring-border/50\",\r\n            className\r\n          )}\r\n          style={{\r\n            ...positionStyles,\r\n            overflow: submenuStylesActive ? \"visible\" : \"hidden\",\r\n            cursor: open ? \"default\" : \"pointer\",\r\n            transformOrigin: submenuStylesActive\r\n              ? \"center center\"\r\n              : transformOrigin,\r\n            zIndex: open ? 50 : \"auto\",\r\n            willChange: \"transform\",\r\n            ...style,\r\n          }}\r\n        >\r\n          <div ref={measureRef}>{children}</div>\r\n        </motion.div>\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\nContainer.displayName = \"PullDownContainer\";\r\n\r\n// =============================================================================\r\n// TRIGGER COMPONENT\r\n// =============================================================================\r\n\r\nconst Trigger = forwardRef<HTMLDivElement, PullDownTriggerProps>(\r\n  function PullDownTrigger(\r\n    { children, disabled = false, className, style },\r\n    ref\r\n  ) {\r\n    const {\r\n      open,\r\n      setOpen,\r\n      triggerRef,\r\n      animationConfig,\r\n      visualDuration,\r\n      bounce,\r\n      disableAnimation,\r\n    } = usePullDownContext(\"PullDownTrigger\");\r\n\r\n    const prefersReducedMotion = useReducedMotion();\r\n    const shouldAnimate = !disableAnimation && !prefersReducedMotion;\r\n\r\n    const springConfig: Transition = shouldAnimate\r\n      ? {\r\n          type: \"spring\" as const,\r\n          visualDuration: visualDuration * 0.85,\r\n          bounce,\r\n        }\r\n      : { type: \"spring\" as const, ...REDUCED_MOTION_SPRING };\r\n\r\n    const handleClick = useCallback(\r\n      (event: MouseEvent) => {\r\n        if (disabled) return;\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        setOpen(!open);\r\n      },\r\n      [disabled, setOpen, open]\r\n    );\r\n\r\n    const handleKeyDown = useCallback(\r\n      (event: KeyboardEvent) => {\r\n        if (disabled) return;\r\n        if (event.key === \"Enter\" || event.key === \" \") {\r\n          event.preventDefault();\r\n          setOpen(!open);\r\n        }\r\n        if (event.key === \"ArrowDown\" && !open) {\r\n          event.preventDefault();\r\n          setOpen(true);\r\n        }\r\n      },\r\n      [disabled, setOpen, open]\r\n    );\r\n\r\n    const triggerContentVariants: Variants = {\r\n      visible: {\r\n        opacity: 1,\r\n        filter: \"blur(0px)\",\r\n      },\r\n      hidden: {\r\n        opacity: 0,\r\n        filter: shouldAnimate\r\n          ? `blur(${animationConfig.triggerBlur}px)`\r\n          : \"blur(0px)\",\r\n      },\r\n    };\r\n\r\n    return (\r\n      <AnimatePresence initial={false}>\r\n        {!open && (\r\n          <motion.div\r\n            ref={(node) => {\r\n              if (ref) {\r\n                if (typeof ref === \"function\") {\r\n                  ref(node);\r\n                } else {\r\n                  ref.current = node;\r\n                }\r\n              }\r\n              triggerRef.current = node;\r\n            }}\r\n            key=\"trigger-icon\"\r\n            layout={false}\r\n            initial=\"hidden\"\r\n            animate=\"visible\"\r\n            exit=\"hidden\"\r\n            variants={triggerContentVariants}\r\n            transition={springConfig}\r\n            onClick={handleClick}\r\n            onKeyDown={handleKeyDown}\r\n            role=\"button\"\r\n            tabIndex={disabled ? -1 : 0}\r\n            aria-expanded={open}\r\n            aria-haspopup=\"menu\"\r\n            aria-disabled={disabled}\r\n            className={cn(className)}\r\n            style={{\r\n              position: \"absolute\",\r\n              inset: 0,\r\n              display: \"flex\",\r\n              alignItems: \"center\",\r\n              justifyContent: \"center\",\r\n              cursor: disabled ? \"not-allowed\" : \"pointer\",\r\n              ...style,\r\n            }}\r\n          >\r\n            {children}\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    );\r\n  }\r\n);\r\n\r\nTrigger.displayName = \"PullDownTrigger\";\r\n\r\n// =============================================================================\r\n// CONTENT COMPONENT\r\n// =============================================================================\r\n\r\nconst Content = forwardRef<HTMLDivElement, PullDownContentProps>(\r\n  function PullDownContent(\r\n    { children, className, style, onAnimationComplete },\r\n    ref\r\n  ) {\r\n    const {\r\n      open,\r\n      contentRef,\r\n      animationConfig,\r\n      isOpenAnimationCompleteRef,\r\n      direction,\r\n      visualDuration,\r\n      bounce,\r\n      disableAnimation,\r\n    } = usePullDownContext(\"PullDownContent\");\r\n\r\n    const prefersReducedMotion = useReducedMotion();\r\n    const shouldAnimate = !disableAnimation && !prefersReducedMotion;\r\n\r\n    const springConfig: Transition = shouldAnimate\r\n      ? {\r\n          type: \"spring\" as const,\r\n          visualDuration: visualDuration * 0.85,\r\n          bounce,\r\n        }\r\n      : { type: \"spring\" as const, ...REDUCED_MOTION_SPRING };\r\n\r\n    const getOffset = (amount: number) => {\r\n      switch (direction) {\r\n        case \"top\":\r\n          return { x: 0, y: amount };\r\n        case \"bottom\":\r\n          return { x: 0, y: -amount };\r\n        case \"left\":\r\n          return { x: amount, y: 0 };\r\n        case \"right\":\r\n          return { x: -amount, y: 0 };\r\n      }\r\n    };\r\n\r\n    const hiddenOffset = getOffset(8);\r\n    const exitOffset = getOffset(30);\r\n\r\n    const contentVariants: Variants = {\r\n      visible: {\r\n        opacity: 1,\r\n        scale: 1,\r\n        x: 0,\r\n        y: 0,\r\n        filter: \"blur(0px)\",\r\n        transition: {\r\n          ...springConfig,\r\n          delay: shouldAnimate ? animationConfig.contentDelay : 0,\r\n        },\r\n      },\r\n      hidden: {\r\n        opacity: 0,\r\n        scale: animationConfig.contentScale,\r\n        ...hiddenOffset,\r\n        filter: shouldAnimate\r\n          ? `blur(${animationConfig.contentBlur}px)`\r\n          : \"blur(0px)\",\r\n      },\r\n      exit: {\r\n        opacity: 0,\r\n        scale: 0.9,\r\n        ...exitOffset,\r\n        filter: shouldAnimate\r\n          ? `blur(${animationConfig.contentBlur}px)`\r\n          : \"blur(0px)\",\r\n        transition: {\r\n          duration: 0.2,\r\n          ease: [0.4, 0, 1, 1],\r\n        },\r\n      },\r\n    };\r\n\r\n    const setRef = useCallback(\r\n      (node: HTMLDivElement | null) => {\r\n        if (ref) {\r\n          if (typeof ref === \"function\") {\r\n            ref(node);\r\n          } else {\r\n            ref.current = node;\r\n          }\r\n        }\r\n        contentRef.current = node;\r\n      },\r\n      [contentRef, ref]\r\n    );\r\n\r\n    const handleAnimationComplete = useCallback(\r\n      (definition: string) => {\r\n        if (definition === \"visible\") {\r\n          isOpenAnimationCompleteRef.current = true;\r\n        }\r\n        onAnimationComplete?.();\r\n      },\r\n      [isOpenAnimationCompleteRef, onAnimationComplete]\r\n    );\r\n\r\n    return (\r\n      <AnimatePresence>\r\n        {open && (\r\n          <motion.div\r\n            ref={setRef}\r\n            key=\"pulldown-content\"\r\n            role=\"menu\"\r\n            initial=\"hidden\"\r\n            animate=\"visible\"\r\n            exit=\"exit\"\r\n            variants={contentVariants}\r\n            transition={{\r\n              ...springConfig,\r\n              delay: shouldAnimate ? animationConfig.contentDelay : 0,\r\n            }}\r\n            onAnimationComplete={handleAnimationComplete}\r\n            className={cn(className)}\r\n            style={{ position: \"relative\", ...style }}\r\n          >\r\n            {children}\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    );\r\n  }\r\n);\r\n\r\nContent.displayName = \"PullDownContent\";\r\n\r\n// =============================================================================\r\n// ITEM COMPONENT\r\n// =============================================================================\r\n\r\nconst Item = forwardRef<HTMLDivElement, PullDownItemProps>(\r\n  function PullDownItem(\r\n    {\r\n      children,\r\n      onSelect,\r\n      disabled = false,\r\n      closeOnSelect = true,\r\n      className,\r\n      style,\r\n    },\r\n    ref\r\n  ) {\r\n    const {\r\n      setOpen,\r\n      isOpenAnimationCompleteRef,\r\n      activeSubmenu,\r\n      visualDuration,\r\n      bounce,\r\n      disableAnimation,\r\n    } = usePullDownContext(\"PullDownItem\");\r\n\r\n    const subMenuContext = useContext(SubMenuContext);\r\n    const [isHovered, setIsHovered] = useState(false);\r\n    const prefersReducedMotion = useReducedMotion();\r\n\r\n    const isInsideActiveSubmenu =\r\n      subMenuContext && activeSubmenu === subMenuContext.id;\r\n    const shouldDim = activeSubmenu !== null && !isInsideActiveSubmenu;\r\n\r\n    const shouldAnimate = !disableAnimation && !prefersReducedMotion;\r\n    const springConfig: Transition = shouldAnimate\r\n      ? { type: \"spring\" as const, visualDuration, bounce }\r\n      : { type: \"spring\" as const, ...REDUCED_MOTION_SPRING };\r\n\r\n    const handleClick = useCallback(\r\n      (event: MouseEvent) => {\r\n        if (disabled) return;\r\n        event.preventDefault();\r\n        onSelect?.();\r\n        if (closeOnSelect) {\r\n          setOpen(false);\r\n        }\r\n      },\r\n      [disabled, onSelect, closeOnSelect, setOpen]\r\n    );\r\n\r\n    const handleMouseEnter = useCallback(() => {\r\n      if (!isOpenAnimationCompleteRef.current) return;\r\n      if (!disabled) {\r\n        setIsHovered(true);\r\n      }\r\n    }, [disabled, isOpenAnimationCompleteRef]);\r\n\r\n    const handleMouseLeave = useCallback(() => {\r\n      setIsHovered(false);\r\n    }, []);\r\n\r\n    return (\r\n      <motion.div\r\n        ref={ref}\r\n        role=\"menuitem\"\r\n        aria-disabled={disabled}\r\n        data-disabled={disabled || undefined}\r\n        data-highlighted={isHovered || undefined}\r\n        onClick={handleClick}\r\n        onMouseEnter={handleMouseEnter}\r\n        onMouseLeave={handleMouseLeave}\r\n        className={cn(\r\n          \"flex cursor-pointer items-center gap-2 rounded-lg px-3 py-2 text-sm outline-none transition-colors\",\r\n          \"hover:bg-accent hover:text-accent-foreground\",\r\n          \"focus:bg-accent focus:text-accent-foreground\",\r\n          \"data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\r\n          className\r\n        )}\r\n        animate={{\r\n          opacity: shouldDim ? 0.5 : 1,\r\n        }}\r\n        transition={springConfig}\r\n        style={{\r\n          cursor: disabled ? \"not-allowed\" : \"pointer\",\r\n          transformOrigin: \"center center\",\r\n          userSelect: \"none\",\r\n          ...style,\r\n        }}\r\n      >\r\n        {children}\r\n      </motion.div>\r\n    );\r\n  }\r\n);\r\n\r\nItem.displayName = \"PullDownItem\";\r\n\r\n// =============================================================================\r\n// PORTAL COMPONENT\r\n// =============================================================================\r\n\r\nfunction Portal({ children, container }: PullDownPortalProps): ReactNode {\r\n  // Use useSyncExternalStore to track mounting in a way that doesn't trigger setState in effect\r\n  const mounted = React.useSyncExternalStore(\r\n    // subscribe - no-op since mount state doesn't change from external sources\r\n    useCallback(() => () => {}, []),\r\n    // getSnapshot - always true on client\r\n    useCallback(() => true, []),\r\n    // getServerSnapshot - always false on server\r\n    useCallback(() => false, [])\r\n  );\r\n\r\n  if (!mounted) {\r\n    return null;\r\n  }\r\n\r\n  const portalContainer = container ?? document.body;\r\n  return createPortal(children, portalContainer);\r\n}\r\n\r\nPortal.displayName = \"PullDownPortal\";\r\n\r\n// =============================================================================\r\n// OVERLAY COMPONENT\r\n// =============================================================================\r\n\r\nconst Overlay = forwardRef<HTMLDivElement, PullDownOverlayProps>(\r\n  function PullDownOverlay({ className, style, onClick }, ref) {\r\n    const { open, setOpen, visualDuration, bounce, disableAnimation } =\r\n      usePullDownContext(\"PullDownOverlay\");\r\n\r\n    const prefersReducedMotion = useReducedMotion();\r\n    const shouldAnimate = !disableAnimation && !prefersReducedMotion;\r\n\r\n    const springConfig: Transition = shouldAnimate\r\n      ? { type: \"spring\" as const, visualDuration, bounce }\r\n      : { type: \"spring\" as const, ...REDUCED_MOTION_SPRING };\r\n\r\n    const handleClick = useCallback(\r\n      (event: MouseEvent) => {\r\n        event.preventDefault();\r\n        if (onClick) {\r\n          onClick();\r\n        } else {\r\n          setOpen(false);\r\n        }\r\n      },\r\n      [onClick, setOpen]\r\n    );\r\n\r\n    const overlayVariants: Variants = {\r\n      visible: { opacity: 1 },\r\n      hidden: { opacity: 0 },\r\n    };\r\n\r\n    return (\r\n      <AnimatePresence>\r\n        {open && (\r\n          <motion.div\r\n            ref={ref}\r\n            key=\"pulldown-overlay\"\r\n            initial=\"hidden\"\r\n            animate=\"visible\"\r\n            exit=\"hidden\"\r\n            variants={overlayVariants}\r\n            transition={springConfig}\r\n            onClick={handleClick}\r\n            className={cn(\"bg-background/80 backdrop-blur-sm\", className)}\r\n            style={{\r\n              position: \"fixed\",\r\n              inset: 0,\r\n              ...style,\r\n            }}\r\n            aria-hidden=\"true\"\r\n          />\r\n        )}\r\n      </AnimatePresence>\r\n    );\r\n  }\r\n);\r\n\r\nOverlay.displayName = \"PullDownOverlay\";\r\n\r\n// =============================================================================\r\n// SEPARATOR COMPONENT\r\n// =============================================================================\r\n\r\nconst Separator = forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(function PullDownSeparator({ className, ...props }, ref) {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      className={cn(\"my-1 h-px bg-border\", className)}\r\n      role=\"separator\"\r\n      {...props}\r\n    />\r\n  );\r\n});\r\n\r\nSeparator.displayName = \"PullDownSeparator\";\r\n\r\n// =============================================================================\r\n// LABEL COMPONENT\r\n// =============================================================================\r\n\r\nconst Label = forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\r\n  function PullDownLabel({ className, ...props }, ref) {\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        className={cn(\r\n          \"px-3 py-1.5 text-xs font-medium text-muted-foreground\",\r\n          className\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  }\r\n);\r\n\r\nLabel.displayName = \"PullDownLabel\";\r\n\r\n// =============================================================================\r\n// SUBMENU COMPONENT\r\n// =============================================================================\r\n\r\nfunction SubMenu({ children, id }: PullDownSubMenuProps): ReactNode {\r\n  const triggerRef = useRef<HTMLDivElement>(null);\r\n  const contextValue = useMemo(() => ({ id, triggerRef }), [id]);\r\n\r\n  return (\r\n    <SubMenuContext.Provider value={contextValue}>\r\n      {children}\r\n    </SubMenuContext.Provider>\r\n  );\r\n}\r\n\r\nSubMenu.displayName = \"PullDownSubMenu\";\r\n\r\n// =============================================================================\r\n// SUBMENU TRIGGER COMPONENT\r\n// =============================================================================\r\n\r\nconst SubMenuTrigger = forwardRef<HTMLDivElement, PullDownSubMenuTriggerProps>(\r\n  function PullDownSubMenuTrigger(\r\n    { children, className, style, disabled = false },\r\n    ref\r\n  ) {\r\n    const {\r\n      setActiveSubmenu,\r\n      activeSubmenu,\r\n      isSubmenuClosing,\r\n      visualDuration,\r\n      bounce,\r\n      disableAnimation,\r\n    } = usePullDownContext(\"PullDownSubMenuTrigger\");\r\n\r\n    const { id, triggerRef } = useSubMenuContext();\r\n    const prefersReducedMotion = useReducedMotion();\r\n\r\n    const isActive = activeSubmenu === id;\r\n    // Elevated state: active OR closing (for exit animation)\r\n    const isElevated = isActive || isSubmenuClosing;\r\n\r\n    const shouldAnimate = !disableAnimation && !prefersReducedMotion;\r\n    const springConfig: Transition = shouldAnimate\r\n      ? { type: \"spring\" as const, visualDuration, bounce }\r\n      : { type: \"spring\" as const, ...REDUCED_MOTION_SPRING };\r\n\r\n    const openScale = 1.06 / 0.96;\r\n\r\n    const handleClick = useCallback(\r\n      (event: MouseEvent) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n        if (!disabled) {\r\n          setActiveSubmenu(isActive ? null : id);\r\n        }\r\n      },\r\n      [disabled, setActiveSubmenu, id, isActive]\r\n    );\r\n\r\n    const handleKeyDown = useCallback(\r\n      (event: KeyboardEvent) => {\r\n        if (disabled) return;\r\n        if (event.key === \"Enter\" || event.key === \" \") {\r\n          event.preventDefault();\r\n          setActiveSubmenu(isActive ? null : id);\r\n        } else if (event.key === \"ArrowRight\" && !isActive) {\r\n          event.preventDefault();\r\n          setActiveSubmenu(id);\r\n        } else if (\r\n          (event.key === \"ArrowLeft\" || event.key === \"Escape\") &&\r\n          isActive\r\n        ) {\r\n          event.preventDefault();\r\n          setActiveSubmenu(null);\r\n        }\r\n      },\r\n      [disabled, setActiveSubmenu, id, isActive]\r\n    );\r\n\r\n    const content =\r\n      typeof children === \"function\" ? children(isActive) : children;\r\n\r\n    return (\r\n      <motion.div\r\n        ref={(node) => {\r\n          if (ref) {\r\n            if (typeof ref === \"function\") {\r\n              ref(node);\r\n            } else {\r\n              ref.current = node;\r\n            }\r\n          }\r\n          triggerRef.current = node;\r\n        }}\r\n        role=\"menuitem\"\r\n        aria-haspopup=\"menu\"\r\n        aria-expanded={isActive}\r\n        aria-disabled={disabled || undefined}\r\n        tabIndex={disabled ? -1 : 0}\r\n        data-active={isActive || undefined}\r\n        data-elevated={isElevated || undefined}\r\n        className={cn(\r\n          \"flex cursor-pointer items-center justify-between gap-2 rounded-lg px-3 py-2 text-sm outline-none transition-colors\",\r\n          \"hover:bg-accent hover:text-accent-foreground\",\r\n          \"focus:bg-accent focus:text-accent-foreground\",\r\n          \"data-[elevated]:hover:bg-transparent\",\r\n          className\r\n        )}\r\n        initial={false}\r\n        animate={{\r\n          scale: isActive ? openScale : 1,\r\n        }}\r\n        transition={springConfig}\r\n        style={{\r\n          ...style,\r\n          position: \"relative\",\r\n          zIndex: isElevated ? 20 : undefined,\r\n          transformOrigin: \"top center\",\r\n          userSelect: \"none\",\r\n        }}\r\n        onClick={handleClick}\r\n        onKeyDown={handleKeyDown}\r\n      >\r\n        {content}\r\n      </motion.div>\r\n    );\r\n  }\r\n);\r\n\r\nSubMenuTrigger.displayName = \"PullDownSubMenuTrigger\";\r\n\r\n// =============================================================================\r\n// SUBMENU CONTENT COMPONENT\r\n// =============================================================================\r\n\r\nconst SubMenuContent = forwardRef<HTMLDivElement, PullDownSubMenuContentProps>(\r\n  function PullDownSubMenuContent({ children, className, style }, ref) {\r\n    const {\r\n      activeSubmenu,\r\n      setActiveSubmenu,\r\n      contentRef: mainContentRef,\r\n      visualDuration,\r\n      bounce,\r\n      disableAnimation,\r\n    } = usePullDownContext(\"PullDownSubMenuContent\");\r\n\r\n    const { id, triggerRef } = useSubMenuContext();\r\n    const prefersReducedMotion = useReducedMotion();\r\n    const subMenuRef = useRef<HTMLDivElement>(null);\r\n    const measureRef = useRef<HTMLDivElement>(null);\r\n\r\n    const [triggerTop, setTriggerTop] = useState(0);\r\n    const [triggerHeight, setTriggerHeight] = useState(44);\r\n    const [contentHeight, setContentHeight] = useState(triggerHeight);\r\n\r\n    const isActive = activeSubmenu === id;\r\n\r\n    useLayoutEffect(() => {\r\n      if (isActive && triggerRef.current) {\r\n        setTriggerTop(triggerRef.current.offsetTop);\r\n        setTriggerHeight(triggerRef.current.offsetHeight);\r\n      }\r\n    }, [isActive, triggerRef]);\r\n\r\n    useLayoutEffect(() => {\r\n      if (isActive && measureRef.current) {\r\n        setContentHeight(measureRef.current.offsetHeight);\r\n      }\r\n    }, [isActive, children, triggerHeight]);\r\n\r\n    useEffect(() => {\r\n      if (!isActive) return;\r\n\r\n      const handleClickOutside = (event: globalThis.MouseEvent) => {\r\n        const target = event.target as Node;\r\n\r\n        if (subMenuRef.current?.contains(target)) {\r\n          return;\r\n        }\r\n\r\n        if (triggerRef.current?.contains(target)) {\r\n          return;\r\n        }\r\n\r\n        if (mainContentRef.current?.contains(target)) {\r\n          event.stopPropagation();\r\n          setActiveSubmenu(null);\r\n          return;\r\n        }\r\n\r\n        setActiveSubmenu(null);\r\n      };\r\n\r\n      const timeoutId = setTimeout(() => {\r\n        document.addEventListener(\"mousedown\", handleClickOutside, true);\r\n      }, 0);\r\n\r\n      return () => {\r\n        clearTimeout(timeoutId);\r\n        document.removeEventListener(\"mousedown\", handleClickOutside, true);\r\n      };\r\n    }, [isActive, setActiveSubmenu, mainContentRef, triggerRef]);\r\n\r\n    const shouldAnimate = !disableAnimation && !prefersReducedMotion;\r\n    const springConfig: Transition = shouldAnimate\r\n      ? { type: \"spring\" as const, visualDuration, bounce }\r\n      : { type: \"spring\" as const, ...REDUCED_MOTION_SPRING };\r\n\r\n    const contentSpringConfig: Transition = shouldAnimate\r\n      ? {\r\n          type: \"spring\" as const,\r\n          visualDuration: visualDuration * 0.85,\r\n          bounce,\r\n        }\r\n      : { type: \"spring\" as const, ...REDUCED_MOTION_SPRING };\r\n\r\n    const contentVariants: Variants = {\r\n      hidden: {\r\n        opacity: 0,\r\n        filter: shouldAnimate ? `blur(${CONTENT_BLUR}px)` : \"blur(0px)\",\r\n      },\r\n      visible: {\r\n        opacity: 1,\r\n        filter: \"blur(0px)\",\r\n        transition: {\r\n          ...contentSpringConfig,\r\n          delay: 0.05,\r\n        },\r\n      },\r\n      exit: {\r\n        opacity: 0,\r\n        filter: shouldAnimate ? `blur(${CONTENT_BLUR}px)` : \"blur(0px)\",\r\n        transition: {\r\n          duration: 0.15,\r\n        },\r\n      },\r\n    };\r\n\r\n    const openScale = 1.06 / 0.96;\r\n\r\n    return (\r\n      <AnimatePresence>\r\n        {isActive && (\r\n          <motion.div\r\n            ref={(node) => {\r\n              if (ref) {\r\n                if (typeof ref === \"function\") {\r\n                  ref(node);\r\n                } else {\r\n                  ref.current = node;\r\n                }\r\n              }\r\n              (subMenuRef as MutableRefObject<HTMLDivElement | null>).current =\r\n                node;\r\n            }}\r\n            className={cn(\r\n              \"rounded-xl bg-popover p-1 shadow-lg ring-1 ring-border/50\",\r\n              className\r\n            )}\r\n            initial={{\r\n              height: triggerHeight,\r\n              scale: 1,\r\n              opacity: 1,\r\n              pointerEvents: \"auto\" as const,\r\n            }}\r\n            animate={{\r\n              height: contentHeight,\r\n              scale: openScale,\r\n              opacity: 1,\r\n              pointerEvents: \"auto\" as const,\r\n            }}\r\n            exit={{\r\n              height: triggerHeight,\r\n              scale: 1,\r\n              opacity: 0,\r\n              pointerEvents: \"none\" as const,\r\n            }}\r\n            transition={{\r\n              height: springConfig,\r\n              scale: springConfig,\r\n              opacity: { duration: 0.15 },\r\n            }}\r\n            style={{\r\n              ...style,\r\n              position: \"absolute\",\r\n              top: triggerTop,\r\n              left: 0,\r\n              right: 0,\r\n              zIndex: 10,\r\n              overflow: \"hidden\",\r\n              transformOrigin: \"top center\",\r\n              willChange: \"transform, height, opacity\",\r\n              boxSizing: \"content-box\",\r\n            }}\r\n          >\r\n            <div ref={measureRef}>\r\n              <div style={{ height: triggerHeight }} aria-hidden=\"true\" />\r\n              <motion.div\r\n                initial=\"hidden\"\r\n                animate=\"visible\"\r\n                exit=\"exit\"\r\n                variants={contentVariants}\r\n              >\r\n                {children}\r\n              </motion.div>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </AnimatePresence>\r\n    );\r\n  }\r\n);\r\n\r\nSubMenuContent.displayName = \"PullDownSubMenuContent\";\r\n\r\n// =============================================================================\r\n// ICON COMPONENT (for submenu indicator)\r\n// =============================================================================\r\n\r\ninterface PullDownChevronProps {\r\n  isActive?: boolean;\r\n  className?: string;\r\n}\r\n\r\nfunction PullDownChevron({ isActive, className }: PullDownChevronProps) {\r\n  return (\r\n    <CaretRightIcon\r\n      className={cn(\r\n        \"h-4 w-4 text-muted-foreground transition-transform duration-200\",\r\n        isActive && \"rotate-90\",\r\n        className\r\n      )}\r\n    />\r\n  );\r\n}\r\n\r\nPullDownChevron.displayName = \"PullDownChevron\";\r\n\r\n// =============================================================================\r\n// COMPOUND EXPORT\r\n// =============================================================================\r\n\r\nexport const PullDown = Object.assign(Root, {\r\n  Container,\r\n  Trigger,\r\n  Content,\r\n  Item,\r\n  Portal,\r\n  Overlay,\r\n  Separator,\r\n  Label,\r\n  SubMenu,\r\n  SubMenuTrigger,\r\n  SubMenuContent,\r\n  Chevron: PullDownChevron,\r\n});\r\n\r\n// Individual exports for flexibility\r\nexport {\r\n  Root as PullDownRoot,\r\n  Container as PullDownContainer,\r\n  Trigger as PullDownTrigger,\r\n  Content as PullDownContent,\r\n  Item as PullDownItem,\r\n  Portal as PullDownPortal,\r\n  Overlay as PullDownOverlay,\r\n  Separator as PullDownSeparator,\r\n  Label as PullDownLabel,\r\n  SubMenu as PullDownSubMenu,\r\n  SubMenuTrigger as PullDownSubMenuTrigger,\r\n  SubMenuContent as PullDownSubMenuContent,\r\n  PullDownChevron,\r\n};\r\n",
      "type": "registry:ui"
    },
    {
      "path": "components/motion-provider.tsx",
      "content": "\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { createContext, useContext, useMemo } from \"react\";\r\nimport { MotionConfig, type Transition } from \"motion/react\";\r\nimport { useReducedMotion } from \"@/hooks/use-reduced-motion\";\r\nimport { useLowPowerDevice } from \"@/hooks/use-low-power-device\";\r\nimport { transitions } from \"@/lib/motion\";\r\n\r\n// =============================================================================\r\n// TYPES\r\n// =============================================================================\r\n\r\nexport type ReducedMotionSetting = \"user\" | \"always\" | \"never\";\r\n\r\nexport type MotionContextValue = {\r\n  /** Current reduced motion setting */\r\n  reducedMotion: ReducedMotionSetting;\r\n  /** Whether animations are effectively disabled */\r\n  isAnimationDisabled: boolean;\r\n  /** Whether low-power mode auto-disable is enabled */\r\n  lowPowerAutoDisable: boolean;\r\n  /** Low power device state */\r\n  lowPowerState: {\r\n    isLowPower: boolean;\r\n    batteryLevel: number | null;\r\n    isCharging: boolean | null;\r\n  };\r\n  /** Default transition based on current settings */\r\n  defaultTransition: Transition;\r\n};\r\n\r\nexport type MotionProviderProps = {\r\n  children: React.ReactNode;\r\n  /** How to handle reduced motion: 'user' (system preference), 'always' (force reduced), 'never' (force animations) */\r\n  reducedMotion?: ReducedMotionSetting;\r\n  /** Automatically disable animations on low-power devices */\r\n  lowPowerAutoDisable?: boolean;\r\n  /** Default transition for all Motion components */\r\n  defaultTransition?: Transition;\r\n  /** Additional className for the provider wrapper */\r\n  className?: string;\r\n};\r\n\r\n// =============================================================================\r\n// CONTEXT\r\n// =============================================================================\r\n\r\nconst MotionContext = createContext<MotionContextValue | null>(null);\r\n\r\n/**\r\n * Hook to access motion configuration\r\n *\r\n * @returns Motion context value with animation settings\r\n * @throws Error if used outside of MotionProvider\r\n *\r\n * @example\r\n * ```tsx\r\n * function AnimatedButton() {\r\n *   const { isAnimationDisabled } = useMotionConfig();\r\n *\r\n *   return (\r\n *     <motion.button\r\n *       whileTap={isAnimationDisabled ? undefined : { scale: 0.95 }}\r\n *     />\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useMotionConfig(): MotionContextValue {\r\n  const context = useContext(MotionContext);\r\n\r\n  if (!context) {\r\n    throw new Error(\"useMotionConfig must be used within a MotionProvider\");\r\n  }\r\n\r\n  return context;\r\n}\r\n\r\n/**\r\n * Hook to check if animations should be disabled for a component\r\n *\r\n * @param disableAnimation - Optional local override to disable animation\r\n * @returns Whether animations should be disabled\r\n *\r\n * @example\r\n * ```tsx\r\n * function Button({ disableAnimation }) {\r\n *   const shouldDisable = useShouldDisableAnimation(disableAnimation);\r\n *\r\n *   if (shouldDisable) {\r\n *     return <button>Click me</button>;\r\n *   }\r\n *\r\n *   return <motion.button whileTap={{ scale: 0.95 }}>Click me</motion.button>;\r\n * }\r\n * ```\r\n */\r\nexport function useShouldDisableAnimation(disableAnimation?: boolean): boolean {\r\n  const context = useContext(MotionContext);\r\n  const prefersReducedMotion = useReducedMotion();\r\n\r\n  // Local override takes precedence\r\n  if (disableAnimation !== undefined) {\r\n    return disableAnimation;\r\n  }\r\n\r\n  // If no provider, check system preference directly\r\n  if (!context) {\r\n    return prefersReducedMotion;\r\n  }\r\n\r\n  return context.isAnimationDisabled;\r\n}\r\n\r\n/**\r\n * Hook to get the appropriate transition based on animation settings\r\n *\r\n * @param transition - Desired transition when animations are enabled\r\n * @param disableAnimation - Optional local override\r\n * @returns The transition to use (reduced if animations disabled)\r\n */\r\nexport function useAnimationTransition(\r\n  transition: Transition = transitions.default,\r\n  disableAnimation?: boolean,\r\n): Transition {\r\n  const shouldDisable = useShouldDisableAnimation(disableAnimation);\r\n\r\n  if (shouldDisable) {\r\n    return transitions.reduced;\r\n  }\r\n\r\n  return transition;\r\n}\r\n\r\n// =============================================================================\r\n// PROVIDER COMPONENT\r\n// =============================================================================\r\n\r\n/**\r\n * MotionProvider - Global animation configuration provider\r\n *\r\n * Wraps Motion's MotionConfig with additional context for:\r\n * - Reduced motion preferences (system or manual)\r\n * - Low-power device detection\r\n * - Global transition defaults\r\n *\r\n * @example\r\n * ```tsx\r\n * // In your app layout\r\n * <MotionProvider\r\n *   reducedMotion=\"user\"\r\n *   lowPowerAutoDisable\r\n * >\r\n *   <App />\r\n * </MotionProvider>\r\n * ```\r\n */\r\nexport function MotionProvider({\r\n  children,\r\n  reducedMotion = \"user\",\r\n  lowPowerAutoDisable = true,\r\n  defaultTransition = transitions.default,\r\n}: MotionProviderProps) {\r\n  // System preference for reduced motion\r\n  const prefersReducedMotion = useReducedMotion();\r\n\r\n  // Low-power device detection\r\n  const lowPowerState = useLowPowerDevice();\r\n\r\n  // Determine if animations should be disabled\r\n  const isAnimationDisabled = useMemo(() => {\r\n    // 'always' forces reduced motion\r\n    if (reducedMotion === \"always\") {\r\n      return true;\r\n    }\r\n\r\n    // 'never' forces animations (ignores preferences)\r\n    if (reducedMotion === \"never\") {\r\n      return false;\r\n    }\r\n\r\n    // 'user' respects system preference\r\n    if (prefersReducedMotion) {\r\n      return true;\r\n    }\r\n\r\n    // Check low-power mode if auto-disable is enabled\r\n    if (lowPowerAutoDisable && lowPowerState.shouldReduceAnimations) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }, [\r\n    reducedMotion,\r\n    prefersReducedMotion,\r\n    lowPowerAutoDisable,\r\n    lowPowerState.shouldReduceAnimations,\r\n  ]);\r\n\r\n  // Get effective transition\r\n  const effectiveTransition = useMemo(() => {\r\n    if (isAnimationDisabled) {\r\n      return transitions.reduced;\r\n    }\r\n    return defaultTransition;\r\n  }, [isAnimationDisabled, defaultTransition]);\r\n\r\n  // Context value\r\n  const contextValue = useMemo<MotionContextValue>(\r\n    () => ({\r\n      reducedMotion,\r\n      isAnimationDisabled,\r\n      lowPowerAutoDisable,\r\n      lowPowerState: {\r\n        isLowPower: lowPowerState.isLowPower,\r\n        batteryLevel: lowPowerState.batteryLevel,\r\n        isCharging: lowPowerState.isCharging,\r\n      },\r\n      defaultTransition: effectiveTransition,\r\n    }),\r\n    [\r\n      reducedMotion,\r\n      isAnimationDisabled,\r\n      lowPowerAutoDisable,\r\n      lowPowerState.isLowPower,\r\n      lowPowerState.batteryLevel,\r\n      lowPowerState.isCharging,\r\n      effectiveTransition,\r\n    ],\r\n  );\r\n\r\n  return (\r\n    <MotionContext.Provider value={contextValue}>\r\n      <MotionConfig\r\n        transition={effectiveTransition}\r\n        reducedMotion={isAnimationDisabled ? \"always\" : \"user\"}\r\n      >\r\n        {children}\r\n      </MotionConfig>\r\n    </MotionContext.Provider>\r\n  );\r\n}\r\n\r\n// =============================================================================\r\n// EXPORTS\r\n// =============================================================================\r\n\r\nexport { MotionContext };\r\n",
      "type": "registry:component"
    },
    {
      "path": "hooks/use-reduced-motion.ts",
      "content": "\"use client\";\r\n\r\nimport { useSyncExternalStore, useCallback } from \"react\";\r\n\r\n/**\r\n * Hook to detect user's reduced motion preference\r\n *\r\n * Uses the `prefers-reduced-motion` media query to detect if the user\r\n * has requested reduced motion in their system settings.\r\n *\r\n * @param override - Optional boolean to override the system preference\r\n * @returns Whether reduced motion is preferred\r\n *\r\n * @example\r\n * ```tsx\r\n * function MyComponent() {\r\n *   const prefersReducedMotion = useReducedMotion();\r\n *\r\n *   return (\r\n *     <motion.div\r\n *       animate={{ x: prefersReducedMotion ? 0 : 100 }}\r\n *     />\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useReducedMotion(override?: boolean): boolean {\r\n  const subscribe = useCallback((callback: () => void) => {\r\n    if (typeof window === \"undefined\") return () => {};\r\n\r\n    const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\r\n\r\n    mediaQuery.addEventListener(\"change\", callback);\r\n    return () => mediaQuery.removeEventListener(\"change\", callback);\r\n  }, []);\r\n\r\n  const getSnapshot = useCallback(() => {\r\n    if (typeof window === \"undefined\") return false;\r\n    return window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\r\n  }, []);\r\n\r\n  // Server snapshot should always return false for SSR\r\n  const getServerSnapshot = useCallback(() => false, []);\r\n\r\n  const prefersReducedMotion = useSyncExternalStore(\r\n    subscribe,\r\n    getSnapshot,\r\n    getServerSnapshot,\r\n  );\r\n\r\n  // Override takes precedence if provided\r\n  if (override !== undefined) {\r\n    return override;\r\n  }\r\n\r\n  return prefersReducedMotion;\r\n}\r\n\r\nexport default useReducedMotion;\r\n",
      "type": "registry:hook"
    },
    {
      "path": "hooks/use-low-power-device.ts",
      "content": "\"use client\";\r\n\r\nimport { useSyncExternalStore, useCallback } from \"react\";\r\n\r\n/**\r\n * Hook to detect if the device is in a low-power state\r\n *\r\n * Checks Battery API and hardware concurrency to determine if\r\n * animations should be reduced for performance reasons.\r\n *\r\n * @returns Object with power state information\r\n *\r\n * @example\r\n * ```tsx\r\n * function AnimatedComponent() {\r\n *   const { isLowPower, shouldReduceAnimations } = useLowPowerDevice();\r\n *\r\n *   return (\r\n *     <motion.div\r\n *       animate={{ scale: shouldReduceAnimations ? 1 : 1.1 }}\r\n *     />\r\n *   );\r\n * }\r\n * ```\r\n */\r\n\r\ntype BatteryManager = {\r\n  charging: boolean;\r\n  level: number;\r\n  addEventListener: (type: string, listener: () => void) => void;\r\n  removeEventListener: (type: string, listener: () => void) => void;\r\n};\r\n\r\ntype NavigatorWithBattery = Navigator & {\r\n  getBattery?: () => Promise<BatteryManager>;\r\n};\r\n\r\nexport type LowPowerState = {\r\n  /** Whether the device is considered low-power */\r\n  isLowPower: boolean;\r\n  /** Whether animations should be reduced */\r\n  shouldReduceAnimations: boolean;\r\n  /** Battery level (0-1) if available */\r\n  batteryLevel: number | null;\r\n  /** Whether the device is charging */\r\n  isCharging: boolean | null;\r\n  /** Number of logical CPU cores */\r\n  hardwareConcurrency: number;\r\n};\r\n\r\n// Battery state cache\r\nlet batteryManager: BatteryManager | null = null;\r\nlet batteryPromise: Promise<BatteryManager | null> | null = null;\r\n\r\n// Get battery manager (cached)\r\nasync function getBatteryManager(): Promise<BatteryManager | null> {\r\n  if (batteryManager) return batteryManager;\r\n  if (batteryPromise) return batteryPromise;\r\n\r\n  if (typeof navigator === \"undefined\") return null;\r\n\r\n  const nav = navigator as NavigatorWithBattery;\r\n  if (!nav.getBattery) return null;\r\n\r\n  batteryPromise = nav.getBattery().catch(() => null);\r\n  batteryManager = await batteryPromise;\r\n  return batteryManager;\r\n}\r\n\r\n// Initialize battery manager on module load\r\nif (typeof window !== \"undefined\") {\r\n  getBatteryManager();\r\n}\r\n\r\n// Server snapshot - defined once at module level to avoid re-creation\r\nconst serverSnapshot: LowPowerState = {\r\n  isLowPower: false,\r\n  shouldReduceAnimations: false,\r\n  batteryLevel: null,\r\n  isCharging: null,\r\n  hardwareConcurrency: 4,\r\n};\r\n\r\n// Cache the current snapshot to avoid unnecessary re-renders\r\nlet cachedSnapshot: LowPowerState = serverSnapshot;\r\n\r\n// Function to get current snapshot (called outside of React)\r\nfunction getCurrentSnapshot(): LowPowerState {\r\n  if (typeof window === \"undefined\") {\r\n    return serverSnapshot;\r\n  }\r\n\r\n  const hardwareConcurrency = navigator.hardwareConcurrency || 4;\r\n  const isLowEndDevice = hardwareConcurrency <= 4;\r\n\r\n  // Check battery if available\r\n  let batteryLevel: number | null = null;\r\n  let isCharging: boolean | null = null;\r\n  let isLowBattery = false;\r\n\r\n  if (batteryManager) {\r\n    batteryLevel = batteryManager.level;\r\n    isCharging = batteryManager.charging;\r\n    // Consider low battery if below 20% and not charging\r\n    isLowBattery = batteryLevel < 0.2 && !isCharging;\r\n  }\r\n\r\n  const isLowPower = isLowEndDevice || isLowBattery;\r\n  const shouldReduceAnimations = isLowPower;\r\n\r\n  // Only create new object if values actually changed\r\n  const newSnapshot = {\r\n    isLowPower,\r\n    shouldReduceAnimations,\r\n    batteryLevel,\r\n    isCharging,\r\n    hardwareConcurrency,\r\n  };\r\n\r\n  // Compare with cached snapshot\r\n  if (\r\n    cachedSnapshot.isLowPower === newSnapshot.isLowPower &&\r\n    cachedSnapshot.shouldReduceAnimations ===\r\n      newSnapshot.shouldReduceAnimations &&\r\n    cachedSnapshot.batteryLevel === newSnapshot.batteryLevel &&\r\n    cachedSnapshot.isCharging === newSnapshot.isCharging &&\r\n    cachedSnapshot.hardwareConcurrency === newSnapshot.hardwareConcurrency\r\n  ) {\r\n    return cachedSnapshot;\r\n  }\r\n\r\n  cachedSnapshot = newSnapshot;\r\n  return cachedSnapshot;\r\n}\r\n\r\nexport function useLowPowerDevice(): LowPowerState {\r\n  const getSnapshot = () => getCurrentSnapshot();\r\n\r\n  const getServerSnapshot = () => serverSnapshot;\r\n\r\n  const subscribe = useCallback((callback: () => void) => {\r\n    if (typeof window === \"undefined\") return () => {};\r\n\r\n    // Subscribe to battery events if available\r\n    getBatteryManager().then((battery) => {\r\n      if (battery) {\r\n        battery.addEventListener(\"chargingchange\", callback);\r\n        battery.addEventListener(\"levelchange\", callback);\r\n      }\r\n    });\r\n\r\n    // Clean up\r\n    return () => {\r\n      if (batteryManager) {\r\n        batteryManager.removeEventListener(\"chargingchange\", callback);\r\n        batteryManager.removeEventListener(\"levelchange\", callback);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);\r\n}\r\n\r\nexport default useLowPowerDevice;\r\n",
      "type": "registry:hook"
    },
    {
      "path": "lib/motion.ts",
      "content": "import type { Transition, Variants } from \"motion/react\";\r\n\r\n// =============================================================================\r\n// SPRING PRESETS\r\n// Spring physics configurations for animations\r\n// =============================================================================\r\n\r\n/**\r\n * Spring presets for consistent animations\r\n */\r\nexport const springPresets = {\r\n  /**\r\n   * Snappy - Quick, responsive interactions (buttons, toggles)\r\n   * High stiffness, high damping = fast and controlled\r\n   */\r\n  snappy: {\r\n    type: \"spring\" as const,\r\n    stiffness: 400,\r\n    damping: 30,\r\n    mass: 1,\r\n  },\r\n\r\n  /**\r\n   * Bouncy - Playful, attention-grabbing (notifications, toasts)\r\n   * Medium stiffness, lower damping = visible bounce\r\n   */\r\n  bouncy: {\r\n    type: \"spring\" as const,\r\n    stiffness: 300,\r\n    damping: 20,\r\n    mass: 1,\r\n  },\r\n\r\n  /**\r\n   * Smooth - Slow transitions (modals, sheets)\r\n   * Lower stiffness, higher damping = graceful movement\r\n   */\r\n  smooth: {\r\n    type: \"spring\" as const,\r\n    stiffness: 200,\r\n    damping: 25,\r\n    mass: 1,\r\n  },\r\n\r\n  /**\r\n   * Gentle - Subtle, background animations (fade, scale)\r\n   * Very low stiffness, high damping = barely perceptible\r\n   */\r\n  gentle: {\r\n    type: \"spring\" as const,\r\n    stiffness: 150,\r\n    damping: 30,\r\n    mass: 1,\r\n  },\r\n\r\n  /**\r\n   * Interactive - Drag and gesture responses\r\n   * Balanced for real-time responsiveness\r\n   */\r\n  interactive: {\r\n    type: \"spring\" as const,\r\n    stiffness: 500,\r\n    damping: 35,\r\n    mass: 0.8,\r\n  },\r\n} as const;\r\n\r\n// =============================================================================\r\n// TRANSITION PRESETS\r\n// Pre-configured transitions for common use cases\r\n// =============================================================================\r\n\r\nexport const transitions = {\r\n  /** Standard transition using snappy spring */\r\n  default: springPresets.snappy as Transition,\r\n\r\n  /** For modal/dialog opening animations */\r\n  modal: springPresets.smooth as Transition,\r\n\r\n  /** For dropdown/popover appearance */\r\n  popover: {\r\n    ...springPresets.snappy,\r\n    duration: 0.2,\r\n  } as Transition,\r\n\r\n  /** For morphing popover with layoutId */\r\n  morphingPopover: {\r\n    type: \"spring\" as const,\r\n    bounce: 0.05,\r\n    duration: 0.3,\r\n  } as Transition,\r\n\r\n  /** For sheet slide-in animations */\r\n  sheet: {\r\n    ...springPresets.smooth,\r\n    damping: 28,\r\n  } as Transition,\r\n\r\n  /** For button press feedback */\r\n  button: {\r\n    ...springPresets.interactive,\r\n    duration: 0.1,\r\n  } as Transition,\r\n\r\n  /** For icon state changes */\r\n  icon: {\r\n    ...springPresets.bouncy,\r\n    duration: 0.3,\r\n  } as Transition,\r\n\r\n  /** For staggered list items */\r\n  stagger: {\r\n    staggerChildren: 0.03,\r\n    delayChildren: 0.05,\r\n  } as Transition,\r\n\r\n  /** Fast fade for overlays */\r\n  fade: {\r\n    type: \"tween\" as const,\r\n    duration: 0.15,\r\n    ease: \"easeOut\",\r\n  } as Transition,\r\n\r\n  /** Reduced motion fallback - instant transitions */\r\n  reduced: {\r\n    type: \"tween\" as const,\r\n    duration: 0,\r\n  } as Transition,\r\n} as const;\r\n\r\n// =============================================================================\r\n// VARIANT FACTORIES\r\n// Create animation variants for common patterns\r\n// =============================================================================\r\n\r\n/**\r\n * Creates scale variants for press/tap interactions\r\n */\r\nexport function createPressVariants(scale: number = 0.97): Variants {\r\n  return {\r\n    idle: { scale: 1 },\r\n    pressed: { scale },\r\n  };\r\n}\r\n\r\n/**\r\n * Creates hover scale variants\r\n */\r\nexport function createHoverVariants(scale: number = 1.02): Variants {\r\n  return {\r\n    idle: { scale: 1 },\r\n    hovered: { scale },\r\n  };\r\n}\r\n\r\n/**\r\n * Creates fade + scale variants for modal-like components\r\n */\r\nexport function createModalVariants(options?: {\r\n  initialScale?: number;\r\n  exitScale?: number;\r\n}): Variants {\r\n  const { initialScale = 0.95, exitScale = 0.95 } = options ?? {};\r\n\r\n  return {\r\n    initial: {\r\n      opacity: 0,\r\n      scale: initialScale,\r\n    },\r\n    animate: {\r\n      opacity: 1,\r\n      scale: 1,\r\n    },\r\n    exit: {\r\n      opacity: 0,\r\n      scale: exitScale,\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Creates slide variants for sheets/drawers\r\n */\r\nexport function createSlideVariants(\r\n  side: \"top\" | \"right\" | \"bottom\" | \"left\",\r\n): Variants {\r\n  const transforms: Record<\r\n    string,\r\n    { x?: string | number; y?: string | number }\r\n  > = {\r\n    top: { y: \"-100%\" },\r\n    right: { x: \"100%\" },\r\n    bottom: { y: \"100%\" },\r\n    left: { x: \"-100%\" },\r\n  };\r\n\r\n  return {\r\n    initial: { ...transforms[side], opacity: 0 },\r\n    animate: { x: 0, y: 0, opacity: 1 },\r\n    exit: { ...transforms[side], opacity: 0 },\r\n  };\r\n}\r\n\r\n/**\r\n * Creates staggered children variants for lists\r\n */\r\nexport function createStaggerVariants(options?: {\r\n  staggerChildren?: number;\r\n  delayChildren?: number;\r\n}): Variants {\r\n  const { staggerChildren = 0.03, delayChildren = 0.05 } = options ?? {};\r\n\r\n  return {\r\n    initial: { opacity: 0 },\r\n    animate: {\r\n      opacity: 1,\r\n      transition: {\r\n        staggerChildren,\r\n        delayChildren,\r\n      },\r\n    },\r\n    exit: {\r\n      opacity: 0,\r\n      transition: {\r\n        staggerChildren: staggerChildren / 2,\r\n        staggerDirection: -1,\r\n      },\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Creates item variants for staggered lists\r\n */\r\nexport function createStaggerItemVariants(options?: {\r\n  y?: number;\r\n  scale?: number;\r\n}): Variants {\r\n  const { y = 10, scale = 0.95 } = options ?? {};\r\n\r\n  return {\r\n    initial: { opacity: 0, y, scale },\r\n    animate: { opacity: 1, y: 0, scale: 1 },\r\n    exit: { opacity: 0, y: y / 2, scale },\r\n  };\r\n}\r\n\r\n/**\r\n * Creates morphing popover variants with blur\r\n */\r\nexport function createMorphingPopoverVariants(options?: {\r\n  initialScale?: number;\r\n  exitScale?: number;\r\n  initialBlur?: number;\r\n  exitBlur?: number;\r\n}): Variants {\r\n  const {\r\n    initialScale = 0.9,\r\n    exitScale = 0.95,\r\n    initialBlur = 10,\r\n    exitBlur = 10,\r\n  } = options ?? {};\r\n\r\n  return {\r\n    initial: {\r\n      opacity: 0,\r\n      scale: initialScale,\r\n      filter: `blur(${initialBlur}px)`,\r\n    },\r\n    animate: {\r\n      opacity: 1,\r\n      scale: 1,\r\n      filter: \"blur(0px)\",\r\n      transition: {\r\n        type: \"spring\",\r\n        bounce: 0,\r\n        duration: 0.3,\r\n        staggerChildren: 0.05,\r\n      },\r\n    },\r\n    exit: {\r\n      opacity: 0,\r\n      scale: exitScale,\r\n      filter: `blur(${exitBlur}px)`,\r\n      transition: {\r\n        duration: 0.2,\r\n      },\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Creates backdrop/overlay variants\r\n */\r\nexport function createBackdropVariants(): Variants {\r\n  return {\r\n    initial: { opacity: 0 },\r\n    animate: { opacity: 1 },\r\n    exit: { opacity: 0 },\r\n  };\r\n}\r\n\r\n/**\r\n * Creates origin-aware scale variants for popovers/dropdowns\r\n * Scales from the origin point (where it appears from)\r\n */\r\nexport function createPopoverVariants(options?: {\r\n  initialScale?: number;\r\n  originX?: number;\r\n  originY?: number;\r\n}): Variants {\r\n  const { initialScale = 0.95, originX = 0.5, originY = 0 } = options ?? {};\r\n\r\n  return {\r\n    initial: {\r\n      opacity: 0,\r\n      scale: initialScale,\r\n      originX,\r\n      originY,\r\n    },\r\n    animate: {\r\n      opacity: 1,\r\n      scale: 1,\r\n    },\r\n    exit: {\r\n      opacity: 0,\r\n      scale: initialScale,\r\n    },\r\n  };\r\n}\r\n\r\n// =============================================================================\r\n// GESTURE PRESETS\r\n// Common gesture configurations\r\n// =============================================================================\r\n\r\nexport const gestures = {\r\n  /** Standard button tap feedback */\r\n  button: {\r\n    whileTap: { scale: 0.97 },\r\n    whileHover: { scale: 1.02 },\r\n  },\r\n\r\n  /** Subtle press for secondary actions */\r\n  subtle: {\r\n    whileTap: { scale: 0.99 },\r\n  },\r\n\r\n  /** Icon button feedback */\r\n  iconButton: {\r\n    whileTap: { scale: 0.9 },\r\n    whileHover: { scale: 1.1 },\r\n  },\r\n\r\n  /** Card hover effect */\r\n  card: {\r\n    whileHover: { scale: 1.02, y: -4 },\r\n    transition: springPresets.smooth,\r\n  },\r\n\r\n  /** List item hover */\r\n  listItem: {\r\n    whileHover: { x: 4 },\r\n    transition: springPresets.snappy,\r\n  },\r\n} as const;\r\n\r\n// =============================================================================\r\n// DRAG CONFIGURATION\r\n// For swipeable/draggable components\r\n// =============================================================================\r\n\r\nexport const dragConfig = {\r\n  /** Sheet swipe-to-dismiss threshold */\r\n  sheet: {\r\n    dismissThreshold: 100,\r\n    velocityThreshold: 500,\r\n  },\r\n\r\n  /** Drag constraints for bounded elements */\r\n  bounded: {\r\n    elastic: 0.1,\r\n    power: 0.8,\r\n  },\r\n} as const;\r\n\r\n// =============================================================================\r\n// EASING FUNCTIONS\r\n// Cubic-bezier curves for animations\r\n// =============================================================================\r\n\r\nexport const easings = {\r\n  /** Standard curve */\r\n  standard: [0.25, 0.1, 0.25, 1],\r\n  /** Ease-in */\r\n  easeIn: [0.42, 0, 1, 1],\r\n  /** Ease-out */\r\n  easeOut: [0, 0, 0.58, 1],\r\n  /** Emphasized */\r\n  emphasis: [0.33, 1, 0.68, 1],\r\n  /** Linear */\r\n  linear: [0, 0, 1, 1],\r\n} as const;\r\n\r\n// =============================================================================\r\n// DURATION PRESETS\r\n// Consistent timing values\r\n// =============================================================================\r\n\r\nexport const durations = {\r\n  instant: 0,\r\n  fast: 0.1,\r\n  normal: 0.2,\r\n  slow: 0.3,\r\n  slower: 0.5,\r\n  slowest: 0.8,\r\n} as const;\r\n\r\n// =============================================================================\r\n// UTILITY FUNCTIONS\r\n// =============================================================================\r\n\r\n/**\r\n * Combines multiple variant objects\r\n */\r\nexport function mergeVariants(...variants: Variants[]): Variants {\r\n  return variants.reduce((acc, variant) => ({ ...acc, ...variant }), {});\r\n}\r\n\r\n/**\r\n * Creates a transition that respects reduced motion\r\n */\r\nexport function getTransition(\r\n  transition: Transition,\r\n  prefersReducedMotion: boolean,\r\n): Transition {\r\n  if (prefersReducedMotion) {\r\n    return transitions.reduced;\r\n  }\r\n  return transition;\r\n}\r\n\r\n/**\r\n * Generates a layoutId for shared element transitions\r\n */\r\nexport function createLayoutId(prefix: string, id: string | number): string {\r\n  return `${prefix}-${id}`;\r\n}\r\n",
      "type": "registry:lib"
    }
  ],
  "cssVars": {
    "light": {
      "radius": "0.75rem",
      "background": "oklch(1 0 0)",
      "foreground": "oklch(0.145 0 0)",
      "card": "oklch(1 0 0)",
      "card-foreground": "oklch(0.145 0 0)",
      "popover": "oklch(1 0 0)",
      "popover-foreground": "oklch(0.145 0 0)",
      "primary": "oklch(0.205 0 0)",
      "primary-foreground": "oklch(0.985 0 0)",
      "secondary": "oklch(0.97 0 0)",
      "secondary-foreground": "oklch(0.205 0 0)",
      "muted": "oklch(0.97 0 0)",
      "muted-foreground": "oklch(0.556 0 0)",
      "accent": "oklch(0.97 0 0)",
      "accent-foreground": "oklch(0.205 0 0)",
      "destructive": "oklch(0.577 0.245 27.325)",
      "destructive-foreground": "oklch(0.985 0 0)",
      "border": "oklch(0.922 0 0)",
      "input": "oklch(0.922 0 0)",
      "ring": "oklch(0.708 0 0)",
      "chart-1": "oklch(0.646 0.222 41.116)",
      "chart-2": "oklch(0.6 0.118 184.704)",
      "chart-3": "oklch(0.398 0.07 227.392)",
      "chart-4": "oklch(0.828 0.189 84.429)",
      "chart-5": "oklch(0.769 0.188 70.08)",
      "sidebar": "oklch(0.985 0 0)",
      "sidebar-foreground": "oklch(0.145 0 0)",
      "sidebar-primary": "oklch(0.205 0 0)",
      "sidebar-primary-foreground": "oklch(0.985 0 0)",
      "sidebar-accent": "oklch(0.97 0 0)",
      "sidebar-accent-foreground": "oklch(0.205 0 0)",
      "sidebar-border": "oklch(0.922 0 0)",
      "sidebar-ring": "oklch(0.708 0 0)",
      "shadow-xs": "0 1px 2px oklch(0 0 0 / 0.04)",
      "shadow-sm": "0 1px 3px oklch(0 0 0 / 0.06), 0 1px 2px oklch(0 0 0 / 0.04)",
      "shadow-md": "0 4px 6px oklch(0 0 0 / 0.05), 0 2px 4px oklch(0 0 0 / 0.04)",
      "shadow-lg": "0 10px 15px oklch(0 0 0 / 0.08), 0 4px 6px oklch(0 0 0 / 0.04)",
      "shadow-xl": "0 20px 25px oklch(0 0 0 / 0.1), 0 8px 10px oklch(0 0 0 / 0.05)",
      "shadow-2xl": "0 25px 50px oklch(0 0 0 / 0.15)"
    },
    "dark": {
      "background": "oklch(0.21 0.006 285.885)",
      "foreground": "oklch(0.985 0 0)",
      "card": "oklch(0.205 0 0)",
      "card-foreground": "oklch(0.985 0 0)",
      "popover": "oklch(0.205 0 0)",
      "popover-foreground": "oklch(0.985 0 0)",
      "primary": "oklch(0.922 0 0)",
      "primary-foreground": "oklch(0.205 0 0)",
      "secondary": "oklch(0.269 0 0)",
      "secondary-foreground": "oklch(0.985 0 0)",
      "muted": "oklch(0.269 0 0)",
      "muted-foreground": "oklch(0.708 0 0)",
      "accent": "oklch(0.269 0 0)",
      "accent-foreground": "oklch(0.985 0 0)",
      "destructive": "oklch(0.704 0.191 22.216)",
      "destructive-foreground": "oklch(0.985 0 0)",
      "border": "oklch(1 0 0 / 10%)",
      "input": "oklch(1 0 0 / 15%)",
      "ring": "oklch(0.556 0 0)",
      "chart-1": "oklch(0.488 0.243 264.376)",
      "chart-2": "oklch(0.696 0.17 162.48)",
      "chart-3": "oklch(0.769 0.188 70.08)",
      "chart-4": "oklch(0.627 0.265 303.9)",
      "chart-5": "oklch(0.645 0.246 16.439)",
      "sidebar": "oklch(0.205 0 0)",
      "sidebar-foreground": "oklch(0.985 0 0)",
      "sidebar-primary": "oklch(0.488 0.243 264.376)",
      "sidebar-primary-foreground": "oklch(0.985 0 0)",
      "sidebar-accent": "oklch(0.269 0 0)",
      "sidebar-accent-foreground": "oklch(0.985 0 0)",
      "sidebar-border": "oklch(1 0 0 / 10%)",
      "sidebar-ring": "oklch(0.556 0 0)",
      "shadow-xs": "0 1px 2px oklch(0 0 0 / 0.1)",
      "shadow-sm": "0 1px 3px oklch(0 0 0 / 0.15), 0 1px 2px oklch(0 0 0 / 0.1)",
      "shadow-md": "0 4px 6px oklch(0 0 0 / 0.15), 0 2px 4px oklch(0 0 0 / 0.1)",
      "shadow-lg": "0 10px 15px oklch(0 0 0 / 0.2), 0 4px 6px oklch(0 0 0 / 0.1)",
      "shadow-xl": "0 20px 25px oklch(0 0 0 / 0.25), 0 8px 10px oklch(0 0 0 / 0.1)",
      "shadow-2xl": "0 25px 50px oklch(0 0 0 / 0.35)"
    },
    "theme": {
      "--color-background": "var(--background)",
      "--color-foreground": "var(--foreground)",
      "--color-card": "var(--card)",
      "--color-card-foreground": "var(--card-foreground)",
      "--color-popover": "var(--popover)",
      "--color-popover-foreground": "var(--popover-foreground)",
      "--color-primary": "var(--primary)",
      "--color-primary-foreground": "var(--primary-foreground)",
      "--color-secondary": "var(--secondary)",
      "--color-secondary-foreground": "var(--secondary-foreground)",
      "--color-muted": "var(--muted)",
      "--color-muted-foreground": "var(--muted-foreground)",
      "--color-accent": "var(--accent)",
      "--color-accent-foreground": "var(--accent-foreground)",
      "--color-destructive": "var(--destructive)",
      "--color-destructive-foreground": "var(--destructive-foreground)",
      "--color-border": "var(--border)",
      "--color-input": "var(--input)",
      "--color-ring": "var(--ring)",
      "--radius-sm": "calc(var(--radius) - 4px)",
      "--radius-md": "calc(var(--radius) - 2px)",
      "--radius-lg": "var(--radius)",
      "--radius-xl": "calc(var(--radius) + 4px)"
    }
  },
  "tailwind": {
    "config": {
      "theme": {
        "extend": {
          "fontFamily": {
            "sans": [
              "var(--font-sans)",
              "Inter",
              "ui-sans-serif",
              "system-ui",
              "-apple-system",
              "BlinkMacSystemFont",
              "Segoe UI",
              "Roboto",
              "Helvetica Neue",
              "Arial",
              "Noto Sans",
              "sans-serif"
            ]
          }
        }
      }
    }
  },
  "css": {
    "@layer base": {
      "*": {
        "border-color": "var(--border)",
        "outline-color": "var(--ring)"
      },
      "body": {
        "background-color": "var(--background)",
        "color": "var(--foreground)"
      }
    }
  }
}